<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel d'Administration - Legendoid'Z RCON</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f4;
            color: #333;
            margin: 20px;
        }

        h1 {
            color: #007bff;
        }

        #output, #websocket-output {
            margin-top: 20px;
            padding: 10px;
            background-color: #fff;
            color: #333;
            border: 1px solid #ccc;
            border-radius: 8px;
            overflow: auto;
        }

        button {
            background-color: #007bff;
            color: #fff;
            padding: 10px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .inline-group {
            display: flex;
            flex-wrap: wrap;
        }

        .input-group {
            margin-right: 10px;
            margin-bottom: 10px;
        }

        label {
            display: block;
            margin-bottom: 5px;
        }

        input {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
    </style>
</head>

<body>

    <h1>Panel d'Administration - Legendoid'Z RCON</h1>
    
    <div id="websocket-output"></div>

    <button onclick="runRcon('players')">Liste des Joueurs</button>

    <div class="inline-group">
        <div class="input-group">
            <label for="commandInput">Commande personnalisée :</label>
            <input type="text" id="commandInput" placeholder="Entrez votre commande">
        </div>
        <button onclick="runCustomCommand()">Exécuter Commande</button>
    </div>

    <button onclick="runRcon('gunshot')">Gunshot Event</button>
    <button onclick="runRcon('startrain')">Démarrer Pluie</button>
    <button onclick="runRcon('stoprain')">Arrêter Pluie</button>
    <button onclick="runRcon('chopper')">Chopper Event</button>

    <div class="inline-group">
        <div class="input-group">
            <label for="banIdInput">Valeur pour banid :</label>
            <input type="text" id="banIdInput" placeholder="STEAM:ID">
        </div>
        <button onclick="runRconBanId()">Ban ID</button>
    </div>

    <div class="inline-group">
        <div class="input-group">
            <label for="newUsernameInput">Nouveau pseudo :</label>
            <input type="text" id="newUsernameInput" placeholder="Entrez le pseudo">
        </div>
        <div class="input-group">
            <label for="newPasswordInput">Nouveau mot de passe :</label>
            <input type="password" id="newPasswordInput" placeholder="Entrez le mot de passe">
        </div>
        <button onclick="runRconAddUser()">Ajouter un utilisateur</button>
    </div>

    <div class="inline-group">
        <div class="input-group">
            <label for="removeUserInput">Utilisateur à retirer de la liste blanche :</label>
            <input type="text" id="removeUserInput" placeholder="Entrez le pseudo">
        </div>
        <button onclick="runRconRemoveUser()">Retirer de la liste blanche</button>
    </div>

    <script>
        const ws = new WebSocket(`ws://${window.location.host}`);

        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            document.getElementById("websocket-output").innerHTML = '<pre>' + data.output + '</pre>';

            setTimeout(function () {
                document.getElementById("websocket-output").innerHTML = '';
            }, 15000);
        };

        function runRcon(command) {
            var fullCommand = command;

            fetch('/runRcon', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ command: fullCommand }),
                })
                .then(response => response.text())
                .then(data => {
                    console.log('Réponse du serveur :', data);
                    document.getElementById("output").innerHTML = '<pre>' + data + '</pre>';
                })
                .catch(error => {
                    console.error('Erreur lors de l\'envoi de la commande RCON:', error);
                });
        }

        function runRconBanId() {
    var banIdValue = document.getElementById("banIdInput").value;

    fetch('/runRconBanId', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ banIdValue: banIdValue }),
        })
        .then(response => response.text())
        .then(data => {
            console.log('Réponse du serveur (banid) :', data);
            
            // Ajoutez le contenu de la réponse dans le div websocket-output
            document.getElementById("websocket-output").innerHTML = '<pre>' + data + '</pre>';
        })
        .catch(error => {
            console.error('Erreur lors de l\'envoi de la commande RCON (banid):', error);
        });
}

        function runRconAddUser() {
            var newUsername = document.getElementById("newUsernameInput").value;
            var newPassword = document.getElementById("newPasswordInput").value;

            if (!newUsername || !newPassword) {
                alert('Veuillez fournir un pseudo et un mot de passe.');
                return;
            }

            var fullCommand = `adduser ${newUsername} ${newPassword}`;

            fetch('/runRconAddUser', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ newUsername: newUsername, newPassword: newPassword }),
                })
                .then(response => response.text())
                .then(data => {
                    console.log('Réponse du serveur (adduser) :', data);
                    document.getElementById("output").innerHTML = '<pre>' + data + '</pre>';
                })
                .catch(error => {
                    console.error('Erreur lors de l\'envoi de la commande RCON (adduser):', error);
                });
        }

        function runRconRemoveUser() {
            var removeUsername = document.getElementById("removeUserInput").value;

            if (!removeUsername) {
                alert('Veuillez fournir un pseudo.');
                return;
            }

            var fullCommand = `removeuserfromwhitelist ${removeUsername}`;

            fetch('/runRcon', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ command: fullCommand }),
                })
                .then(response => response.text())
                .then(data => {
                    console.log('Réponse du serveur (removeuserfromwhitelist) :', data);
                    document.getElementById("output").innerHTML = '<pre>' + data + '</pre>';
                })
                .catch(error => {
                    console.error('Erreur lors de l\'envoi de la commande RCON (removeuserfromwhitelist):', error);
                });
        }

        function runCustomCommand() {
            var customCommand = document.getElementById("commandInput").value;

            if (!customCommand) {
                alert('Veuillez fournir une commande.');
                return;
            }

            fetch('/runRcon', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ command: customCommand }),
                })
                .then(response => response.text())
                .then(data => {
                    console.log('Réponse du serveur (custom command) :', data);
                    document.getElementById("output").innerHTML = '<pre>' + data + '</pre>';
                })
                .catch(error => {
                    console.error('Erreur lors de l\'envoi de la commande RCON (custom command):', error);
                });
        }
    </script>

</body>

</html>
